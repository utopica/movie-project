<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Series Detail - Netflix Style</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #141414;
            color: white;
            font-family: 'Helvetica Neue', Helvetica, sans-serif;
            overflow-x: hidden;
        }

        .hero-section {
            position: relative;
            height: 70vh;
            background: linear-gradient(to bottom, rgba(20,20,20,0.1) 0%, rgba(20,20,20,0.7) 70%, rgba(20,20,20,1) 100%);
            display: flex;
            align-items: flex-end;
            padding: 60px;
        }

        .hero-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }

        .hero-content {
            max-width: 500px;
            z-index: 2;
        }

        .series-title {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .series-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            font-size: 1rem;
        }

        .match-score {
            color: #46d369;
            font-weight: 600;
        }

        .rating {
            background: rgba(255,255,255,0.2);
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-size: 0.9rem;
        }

        .series-overview {
            font-size: 1.05rem;
            line-height: 1.2;
            margin-bottom: 2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-play {
            background: white;
            color: black;
        }

        .btn-play:hover {
            background: rgba(255,255,255,0.8);
        }

        .btn-secondary {
            background: rgba(109, 109, 110, 0.7);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(109, 109, 110, 0.4);
        }

        .btn-secondary.in-favorites {
            background: #e50914;
            color: white;
        }

        .btn-secondary.in-watchlist {
            background: #4CAF50;
            color: white;
        }

        .content-section {
            padding: 0rem 3rem 3rem 3rem;
        }

        .season-selector {
            margin-bottom: 2rem;
        }

        .season-dropdown {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
        }

        .episodes-container {
            position: relative;
        }

        .episodes-slider {
            overflow: hidden;
            position: relative;
        }

        .episodes-track {
            display: flex;
            transition: transform 0.5s ease;
            gap: 1rem;
        }

        .episode-card {
            flex: 0 0 300px;
            background: #2a2a2a;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
            position: relative;
        }

        .episode-card:hover {
            transform: scale(1.05);
        }

        .episode-image {
            width: 100%;
            height: 169px;
            object-fit: cover;
            background: #333;
        }

        .episode-info {
            padding: 1rem;
        }

        .episode-number {
            color: #999;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .episode-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .episode-duration {
            color: #999;
            font-size: 0.9rem;
        }

        .episode-overview-popup {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.95);
            padding: 1rem;
            border-radius: 8px;
            max-width: 280px;
            font-size: 0.9rem;
            line-height: 1.4;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            border: 1px solid #333;
        }

        .episode-card:hover .episode-overview-popup {
            opacity: 1;
            visibility: visible;
            top: -120px;
        }

         .episode-overview-popup {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(-10px);
      background: rgba(0,0,0,0.95);
      color: white;
      padding: 1rem;
      border-radius: 8px;
      max-width: 280px;
      max-height: 150px;
      overflow-y: auto;
      font-size: 0.9rem;
      line-height: 1.4;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      border: 1px solid #333;
      box-shadow: 0 2px 12px rgba(0,0,0,0.5);
    }

        .slider-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.7);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .slider-nav:hover {
            background: rgba(0,0,0,0.9);
            transform: translateY(-50%) scale(1.1);
        }

        .slider-nav.prev {
            left: -25px;
        }

        .slider-nav.next {
            right: -25px;
        }

        .slider-nav:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .slider-nav:disabled:hover {
            transform: translateY(-50%);
            background: rgba(0,0,0,0.7);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 2rem;
            gap: 0.5rem;
        }

        .pagination-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination-dot.active {
            background: white;
            transform: scale(1.2);
        }

        .episode-overview-popup {
      max-height: 150px;
      overflow-y: auto;
    }

    .season-dropdown {
      max-width: 300px;
      overflow-x: auto;
      white-space: nowrap;
    }

    .loading {
      text-align: center;
      color: #bbb;
      font-size: 1.2rem;
      padding: 2rem 0;
    }

        @media (max-width: 768px) {
            .hero-section {
                height: 70vh;
                padding: 2rem;
            }

            .series-title {
                font-size: 2.5rem;
            }

            .content-section {
                padding: 0rem 2rem 2rem 2rem;
            }

            .episode-card {
                flex: 0 0 250px;
            }
        }
    </style>
</head>
<body>
    <div id="loader" class="loading">Loading series...</div>
  <div id="mainContent" style="display: none;">
    <!-- Hero & Overview will be rendered here -->
    <div class="hero-section">
      <img class="hero-backdrop" id="heroBackdrop" src="" alt="Backdrop">
      <div class="hero-content">
        <h1 class="series-title" id="seriesTitle"></h1>
        <div class="series-meta">
          <span class="match-score" id="matchScore"></span>
          <span id="firstAirDate"></span>
        </div>
        <p class="series-overview" id="seriesOverview"></p>
        <div class="action-buttons">
          <button class="btn btn-secondary" id="addToWatchlistBtn">+ My List</button>
          <button class="btn btn-secondary" id="addToFavoritesBtn">ü§ç Add to Favorites</button>
        </div>
      </div>
    </div>

    <div class="content-section">
      <div class="season-selector">
        <select class="season-dropdown" id="seasonSelect">
          <option value="">Select Season</option>
        </select>
      </div>

      <p id="seasonOverview" style="color: #bbb; margin: 1rem 0; font-size: 1rem;"></p>

      <div class="episodes-container" id="episodesContainer">
        <button class="slider-nav prev" id="prevBtn">‚ùÆ</button>
        <div class="episodes-slider">
          <div class="episodes-track" id="episodesTrack"></div>
        </div>
        <button class="slider-nav next" id="nextBtn">‚ùØ</button>
      </div>

      <div class="pagination" id="pagination"></div>
    </div>
  </div>

  <script src="/js/userLists.js"></script>
  <script>
    class SeriesDetailPage {
      constructor() {
        this.currentPage = 0;
        this.episodesPerPage = 4;
        this.currentSeasonEpisodes = [];
        this.totalPages = 0;
        this.seriesData = null;

        this.init();
      }

      async init() {
        const seriesId = window.location.pathname.split('/').pop();
        try {
          await this.loadSeriesData(seriesId);
          this.setupEventListeners();
          this.initializeListButtons();
        } catch (error) {
          console.error('Error initializing:', error);
        }
      }

      async loadSeriesData(id) {
        const res = await fetch(`/api/series/${id}`);
        if (!res.ok) throw new Error("Failed to load series");
        const data = await res.json();

        this.seriesData = data;
        document.getElementById("loader").style.display = "none";
        document.getElementById("mainContent").style.display = "block";

        this.renderSeriesInfo();
        this.renderSeasonSelector();
        if (data.seasons.length > 0) {
          document.getElementById("seasonSelect").value = data.seasons[0]._id;
          this.loadSeason(data.seasons[0]._id);
        }
      }

      renderSeriesInfo() {
        const { series } = this.seriesData;
        document.getElementById("seriesTitle").textContent = series.title;
        document.getElementById("seriesOverview").textContent = series.overview;

        const imgBase = "https://image.tmdb.org/t/p/original";
        document.getElementById("heroBackdrop").src = series.backdropPath ? imgBase + series.backdropPath : "https://via.placeholder.com/1920x1080";

        document.getElementById("matchScore").textContent = series.voteAverage ? series.voteAverage : "";
        document.getElementById("firstAirDate").textContent = new Date(series.firstAirDate).getFullYear();
      }

      renderSeasonSelector() {
        const select = document.getElementById("seasonSelect");
        this.seriesData.seasons.forEach(season => {
          const opt = document.createElement("option");
          opt.value = season._id;
          opt.textContent = season.name;
          select.appendChild(opt);
        });
      }

      loadSeason(id) {
        const season = this.seriesData.seasons.find(s => s._id === id);
        if (!season) return;

        this.currentSeasonEpisodes = season.episodes;
        this.totalPages = Math.ceil(season.episodes.length / this.episodesPerPage);
        this.currentPage = 0;

        document.getElementById("seasonOverview").textContent = season.overview || "No overview available.";
        this.renderEpisodes();
        this.renderPagination();
        this.updateSliderNavigation();
      }

      renderEpisodes() {
        const track = document.getElementById("episodesTrack");
        const start = this.currentPage * this.episodesPerPage;
        const end = start + this.episodesPerPage;
        const list = this.currentSeasonEpisodes.slice(start, end);

        track.innerHTML = "";
        for (const ep of list) {
          const card = document.createElement("div");
          card.className = "episode-card";
          card.innerHTML = `
            <img class="episode-image" src="https://image.tmdb.org/t/p/w300${ep.stillPath}" alt="${ep.name}">
            <div class="episode-info">
              <div class="episode-number">${ep.episodeNumber}</div>
              <div class="episode-title">${ep.name}</div>
              <div class="episode-duration">45m</div>
            </div>
            <div class="episode-overview-popup">${ep.overview}</div>
          `;
          track.appendChild(card);
        }
      }

      renderPagination() {
        const pag = document.getElementById("pagination");
        pag.innerHTML = "";
        for (let i = 0; i < this.totalPages; i++) {
          const dot = document.createElement("div");
          dot.className = `pagination-dot ${i === this.currentPage ? 'active' : ''}`;
          dot.addEventListener("click", () => this.goToPage(i));
          pag.appendChild(dot);
        }
      }

      updateSliderNavigation() {
        document.getElementById("prevBtn").disabled = this.currentPage === 0;
        document.getElementById("nextBtn").disabled = this.currentPage === this.totalPages - 1;
      }

      goToPage(i) {
        if (i >= 0 && i < this.totalPages) {
          this.currentPage = i;
          this.renderEpisodes();
          this.renderPagination();
          this.updateSliderNavigation();
        }
      }

      setupEventListeners() {
        document.getElementById("seasonSelect").addEventListener("change", e => {
          if (e.target.value) this.loadSeason(e.target.value);
        });
        document.getElementById("prevBtn").addEventListener("click", () => this.goToPage(this.currentPage - 1));
        document.getElementById("nextBtn").addEventListener("click", () => this.goToPage(this.currentPage + 1));
        document.addEventListener("keydown", e => {
          if (e.key === "ArrowLeft") this.goToPage(this.currentPage - 1);
          if (e.key === "ArrowRight") this.goToPage(this.currentPage + 1);
        });
      }

      initializeListButtons() {
        if (!this.seriesData) return;

        const watchlistBtn = document.getElementById('addToWatchlistBtn');
        const favoritesBtn = document.getElementById('addToFavoritesBtn');

        // Initialize buttons with series data
        if (watchlistBtn) {
          new WatchlistButton(watchlistBtn, this.seriesData._id, 'series');
        }

        if (favoritesBtn) {
          new FavoriteButton(favoritesBtn, this.seriesData._id, 'series');
        }
      }
    }

    document.addEventListener("DOMContentLoaded", () => new SeriesDetailPage());
  </script>
</body>
</html>
