<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Lists - Filmler ve Diziler</title>
    <link rel="stylesheet" href="/css/main.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #141414;
        color: white;
        line-height: 1.6;
      }

      .header {
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.7) 10%,
          transparent
        );
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
        padding: 1rem 4%;
        transition: background 0.3s ease;
      }

      .header.scrolled {
        background: #141414;
      }

      .nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 1.8rem;
        font-weight: bold;
        color: #e50914;
        text-decoration: none;
      }

      .nav-links {
        display: flex;
        list-style: none;
        gap: 2rem;
      }

      .nav-links a {
        color: white;
        text-decoration: none;
        transition: color 0.3s ease;
      }

      .nav-links a:hover,
      .nav-links a.active {
        color: #e50914;
      }

      .user-menu {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .main-content {
        margin-top: 80px;
        padding: 2rem 4%;
        min-height: calc(100vh - 80px);
      }

      .page-header {
        margin-bottom: 3rem;
      }

      .page-title {
        font-size: 2.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .page-subtitle {
        font-size: 1.1rem;
        color: #b3b3b3;
      }

      .tabs {
        display: flex;
        gap: 2rem;
        margin-bottom: 2rem;
        border-bottom: 1px solid #333;
      }

      .tab {
        background: none;
        border: none;
        color: #b3b3b3;
        font-size: 1.1rem;
        padding: 1rem 0;
        cursor: pointer;
        position: relative;
        transition: color 0.3s ease;
      }

      .tab.active {
        color: white;
      }

      .tab.active::after {
        content: "";
        position: absolute;
        bottom: -1px;
        left: 0;
        right: 0;
        height: 2px;
        background: #e50914;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .content-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
      }

      .content-card {
        background: #222;
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        position: relative;
      }

      .content-card:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }

      .card-image {
        width: 100%;
        height: 300px;
        object-fit: cover;
        background: #333;
      }

      .card-info {
        padding: 1rem;
      }

      .card-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        line-height: 1.3;
      }

      .card-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.9rem;
        color: #b3b3b3;
      }

      .card-rating {
        background: #e50914;
        color: white;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 600;
      }

      .remove-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        border: none;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        font-size: 1.2rem;
      }

      .content-card:hover .remove-btn {
        opacity: 1;
      }

      .remove-btn:hover {
        background: #e50914;
      }

      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #b3b3b3;
      }

      .empty-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      .empty-title {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: white;
      }

      .empty-description {
        font-size: 1rem;
        margin-bottom: 2rem;
      }

      .browse-btn {
        background: #e50914;
        color: white;
        border: none;
        padding: 0.8rem 2rem;
        border-radius: 4px;
        font-size: 1rem;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        transition: background 0.3s ease;
      }

      .browse-btn:hover {
        background: #b20710;
      }

      .loading {
        text-align: center;
        padding: 4rem 2rem;
        color: #b3b3b3;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 3px solid #333;
        border-top: 3px solid #e50914;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .stats {
        display: flex;
        gap: 2rem;
        margin-bottom: 2rem;
      }

      .stat-item {
        background: #222;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        text-align: center;
      }

      .stat-number {
        font-size: 1.5rem;
        font-weight: 600;
        color: #e50914;
      }

      .stat-label {
        font-size: 0.9rem;
        color: #b3b3b3;
      }

      @media (max-width: 768px) {
        .main-content {
          padding: 2rem 2%;
        }

        .content-grid {
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          gap: 1rem;
        }

        .stats {
          flex-direction: column;
          gap: 1rem;
        }

        .tabs {
          gap: 1rem;
        }

        .page-title {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <header class="header" id="header">
      <nav class="nav">
        <a href="/" class="logo">
          <i class="fas fa-film"></i>
          What2Watch
        </a>
        <nav class="nav-links">
          <a href="/">Home</a>
          <a href="/movies">Movies</a>
          <a href="/series">TV Shows</a>
          <a href="/genres" class="active">Browse</a>
        </nav>
      </nav>
    </header>

    <main class="main-content">
      <div class="page-header">
        <h1 class="page-title">Listem</h1>
        <p class="page-subtitle">Favori filmleriniz ve izleme listeniz</p>
      </div>

      <div class="stats" id="stats">
        <div class="stat-item">
          <div class="stat-number" id="favoritesCount">0</div>
          <div class="stat-label">Favoriler</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="watchlistCount">0</div>
          <div class="stat-label">ƒ∞zleme Listesi</div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="favorites">Favoriler</button>
        <button class="tab" data-tab="watchlist">ƒ∞zleme Listesi</button>
      </div>

      <div id="favoritesTab" class="tab-content active">
        <div id="favoritesLoading" class="loading">
          <div class="loading-spinner"></div>
          <p>Favoriler y√ºkleniyor...</p>
        </div>
        <div
          id="favoritesContent"
          class="content-grid"
          style="display: none"
        ></div>
        <div id="favoritesEmpty" class="empty-state" style="display: none">
          <div class="empty-icon">‚ù§Ô∏è</div>
          <h3 class="empty-title">Hen√ºz favori eklemediniz</h3>
          <p class="empty-description">
            Beƒüendiƒüiniz filmleri ve dizileri favorilerinize ekleyerek buradan
            kolayca eri≈üebilirsiniz.
          </p>
          <a href="/movies" class="browse-btn">Filmlere G√∂z At</a>
        </div>
      </div>

      <div id="watchlistTab" class="tab-content">
        <div id="watchlistLoading" class="loading">
          <div class="loading-spinner"></div>
          <p>ƒ∞zleme listesi y√ºkleniyor...</p>
        </div>
        <div
          id="watchlistContent"
          class="content-grid"
          style="display: none"
        ></div>
        <div id="watchlistEmpty" class="empty-state" style="display: none">
          <div class="empty-icon">üì∫</div>
          <h3 class="empty-title">ƒ∞zleme listeniz bo≈ü</h3>
          <p class="empty-description">
            Daha sonra izlemek istediƒüiniz filmleri ve dizileri listenize
            ekleyin.
          </p>
          <a href="/movies" class="browse-btn">Filmlere G√∂z At</a>
        </div>
      </div>
    </main>

    <script src="/js/authUtils.js"></script>
    <script src="/js/userLists.js"></script>
    <script>
      class MyListPage {
        constructor() {
          this.userLists = null;
          this.activeTab = "favorites";
          this.init();
        }

        async init() {
          this.checkAuthentication();
          this.setupEventListeners();
          await this.loadUserLists();
        }

        checkAuthentication() {
          if (!UserListsAPI.isAuthenticated()) {
            window.location.href = "/login.html";
            return;
          }
        }

        setupEventListeners() {
          // Tab switching
          document.querySelectorAll(".tab").forEach((tab) => {
            tab.addEventListener("click", () => {
              const tabName = tab.dataset.tab;
              this.switchTab(tabName);
            });
          });

          // Header scroll effect
          window.addEventListener("scroll", () => {
            const header = document.getElementById("header");
            if (window.scrollY > 100) {
              header.classList.add("scrolled");
            } else {
              header.classList.remove("scrolled");
            }
          });

          // Logout
          document.getElementById("logoutBtn").addEventListener("click", () => {
            localStorage.removeItem("token");
            localStorage.removeItem("user");
            window.location.href = "/login.html";
          });
        }

        switchTab(tabName) {
          // Update active tab
          document.querySelectorAll(".tab").forEach((tab) => {
            tab.classList.remove("active");
          });
          document
            .querySelector(`[data-tab="${tabName}"]`)
            .classList.add("active");

          // Show/hide tab content
          document.querySelectorAll(".tab-content").forEach((content) => {
            content.classList.remove("active");
          });
          document.getElementById(`${tabName}Tab`).classList.add("active");

          this.activeTab = tabName;
        }

        async loadUserLists() {
          try {
            const response = await UserListsAPI.getUserLists();
            if (response.success) {
              this.userLists = response.data;
              this.updateStats();
              this.renderFavorites();
              this.renderWatchlist();
            } else {
              throw new Error(response.message || "Listeler y√ºklenemedi");
            }
          } catch (error) {
            console.error("Error loading user lists:", error);
            UserListsAPI.showNotification(
              "Listeler y√ºklenirken hata olu≈ütu",
              "error"
            );
          }
        }

        updateStats() {
          const favoritesCount =
            (this.userLists.favorites.movies.length || 0) +
            (this.userLists.favorites.series.length || 0);
          const watchlistCount =
            (this.userLists.watchlist.movies.length || 0) +
            (this.userLists.watchlist.series.length || 0);

          document.getElementById("favoritesCount").textContent =
            favoritesCount;
          document.getElementById("watchlistCount").textContent =
            watchlistCount;
        }

        renderFavorites() {
          const loading = document.getElementById("favoritesLoading");
          const content = document.getElementById("favoritesContent");
          const empty = document.getElementById("favoritesEmpty");

          loading.style.display = "none";

          const allFavorites = [
            ...this.userLists.favorites.movies.map((item) => ({
              ...item,
              type: "movie",
            })),
            ...this.userLists.favorites.series.map((item) => ({
              ...item,
              type: "series",
            })),
          ];

          if (allFavorites.length === 0) {
            empty.style.display = "block";
            content.style.display = "none";
          } else {
            empty.style.display = "none";
            content.style.display = "grid";
            content.innerHTML = allFavorites
              .map((item) => this.createContentCard(item, "favorites"))
              .join("");
          }
        }

        renderWatchlist() {
          const loading = document.getElementById("watchlistLoading");
          const content = document.getElementById("watchlistContent");
          const empty = document.getElementById("watchlistEmpty");

          loading.style.display = "none";

          const allWatchlist = [
            ...this.userLists.watchlist.movies.map((item) => ({
              ...item,
              type: "movie",
            })),
            ...this.userLists.watchlist.series.map((item) => ({
              ...item,
              type: "series",
            })),
          ];

          if (allWatchlist.length === 0) {
            empty.style.display = "block";
            content.style.display = "none";
          } else {
            empty.style.display = "none";
            content.style.display = "grid";
            content.innerHTML = allWatchlist
              .map((item) => this.createContentCard(item, "watchlist"))
              .join("");
          }
        }

        createContentCard(item, listType) {
          const imgBase = "https://image.tmdb.org/t/p/w500";
          const title = item.title || item.name;
          const date = item.releaseDate || item.firstAirDate;
          const year = date ? new Date(date).getFullYear() : "N/A";
          const rating = item.voteAverage
            ? Math.round(item.voteAverage * 10)
            : "N/A";
          const posterUrl = item.posterPath
            ? imgBase + item.posterPath
            : "https://via.placeholder.com/300x450";
          const detailUrl =
            item.type === "movie"
              ? `/movies/${item._id}`
              : `/series/${item._id}`;

          return `
                    <div class="content-card" onclick="window.location.href='${detailUrl}'">
                        <button class="remove-btn" onclick="event.stopPropagation(); removeFromList('${item._id}', '${item.type}', '${listType}')" title="Listeden √áƒ±kar">√ó</button>
                        <img class="card-image" src="${posterUrl}" alt="${title}" onerror="this.src='https://via.placeholder.com/300x450'">
                        <div class="card-info">
                            <h3 class="card-title">${title}</h3>
                            <div class="card-meta">
                                <span>${year}</span>
                                <span class="card-rating">${rating}%</span>
                            </div>
                        </div>
                    </div>
                `;
        }

        async removeFromList(itemId, itemType, listType) {
          try {
            let result;
            if (listType === "favorites") {
              result = await UserListsAPI.removeFromFavorites(itemId, itemType);
            } else {
              result = await UserListsAPI.removeFromWatchlist(itemId, itemType);
            }

            if (result.success) {
              UserListsAPI.showNotification(
                `${
                  listType === "favorites" ? "Favorilerden" : "Listeden"
                } √ßƒ±karƒ±ldƒ±`
              );
              await this.loadUserLists(); // Reload to update the display
            } else {
              throw new Error(result.message || "Bir hata olu≈ütu");
            }
          } catch (error) {
            console.error("Error removing from list:", error);
            UserListsAPI.showNotification("√áƒ±karƒ±lƒ±rken hata olu≈ütu", "error");
          }
        }
      }

      // Global function for remove buttons
      function removeFromList(itemId, itemType, listType) {
        if (window.myListPage) {
          window.myListPage.removeFromList(itemId, itemType, listType);
        }
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", () => {
        window.myListPage = new MyListPage();
      });
    </script>
  </body>
</html>
